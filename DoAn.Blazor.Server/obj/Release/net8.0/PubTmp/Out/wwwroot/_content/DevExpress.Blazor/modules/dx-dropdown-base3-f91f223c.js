import{_ as e}from"./_tslib-6e8ca86b.js";import{P as t}from"./dx-html-element-pointer-events-helper-c53bea3a.js";import{E as o}from"./eventhelper-8570b930.js";import{C as n}from"./custom-events-helper-e7f279d3.js";import{d as s}from"./constants-86572358.js";import{P as r}from"./portal-8366b474.js";import{o as i,q as p,r as d,s as l,M as a,t as u}from"./popup-7729314a.js";import{d as h,e as c,f as m}from"./logicaltreehelper-7b19cc30.js";import{DxMaskedInputEditor as E}from"./masked-input-0bfc925a.js";import{k as D}from"./key-f9cbed1b.js";import{I as w}from"./input-df42ed66.js";import{B as v}from"./constants-9c7feb92.js";import{C as b}from"./css-classes-cee8476c.js";import{containsFocusHiddenAttribute as P,addFocusHiddenAttribute as g}from"./focus-utils-405a64a8.js";import{f as y}from"./focustrap-8a58142c.js";import{d as C}from"./dom-da46d023.js";import{n as f}from"./property-4ec0b52d.js";class O extends Event{constructor(){super(O.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}O.eventName=s+".opendropdown";class S extends Event{constructor(){super(S.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}S.eventName=s+".closedropdown";class H extends Event{constructor(){super(H.eventName,{bubbles:!0,composed:!1,cancelable:!0})}}H.eventName=s+".pointerdown",n.register(O.eventName,(e=>e.detail)),n.register(S.eventName,(e=>e.detail));class K{constructor(e){this.boundOnPopupElementChangedHandler=this.onPopupElementChanged.bind(this),this.boundOnPopupShownHandler=this.onPopupShown.bind(this),this.boundOnPopupClosedHandler=this.onPopupClosed.bind(this),this.boundOnPopupPortalElementsChangedHandler=this.onDropDownPortalElementsChanged.bind(this),this.control=e,this.popupPortal=null,this._popupElement=null,this._adaptiveDropDownElement=null}get popupElement(){return this._popupElement}get useMobileFocusBehaviour(){var e;return(null===(e=this._adaptiveDropDownElement)||void 0===e?void 0:e.adaptivityEnabled)||!1}onConnectedCallback(){this.ensurePopupInfrastructure(),this.control.addEventListener(r.eventName,this.boundOnPopupElementChangedHandler)}onDisconnectedCallback(){this.control.removeEventListener(r.eventName,this.boundOnPopupElementChangedHandler),this.disposePopupInfrastructure()}onSlotChanged(){this.disposePopupInfrastructure(),this.ensurePopupInfrastructure()}getPopupPortal(){if(!this.control.shadowRoot)return null;const e=this.control.shadowRoot.querySelector("slot");if(!e)return null;return e.assignedNodes().find((e=>h(e)))}onPopupElementChanged(e){o.getOriginalSource(e)===this.popupPortal&&(this.disposePopupElement(),this.ensurePopupElement())}onPopupShown(e){this.popupElement&&c(this.popupElement)&&this.control.addLogicalChild(this.popupElement)}onPopupClosed(e){this.popupElement&&c(this.popupElement)&&this.control.removeLogicalChild(this.popupElement)}onDropDownPortalElementsChanged(e){this.ensurePopupElement()}ensurePopupInfrastructure(){var e;this.popupPortal=this.getPopupPortal(),null===(e=this.popupPortal)||void 0===e||e.addEventListener(r.eventName,this.boundOnPopupPortalElementsChangedHandler),this.ensurePopupElement()}ensurePopupElement(){var e,t,o;this.popupPortal&&(this._popupElement=null===(e=this.popupPortal)||void 0===e?void 0:e.popupBase,null===(t=this._popupElement)||void 0===t||t.addEventListener(i.eventName,this.boundOnPopupShownHandler),null===(o=this._popupElement)||void 0===o||o.addEventListener(p.eventName,this.boundOnPopupClosedHandler),this._popupElement&&m(this._popupElement)&&(this._adaptiveDropDownElement=this._popupElement),this.control.ensurePopupElement())}disposePopupInfrastructure(){var e;null===(e=this.popupPortal)||void 0===e||e.removeEventListener(r.eventName,this.boundOnPopupPortalElementsChangedHandler),this.popupPortal=null,this._adaptiveDropDownElement=null,this.disposePopupElement()}disposePopupElement(){var e,t;null===(e=this._popupElement)||void 0===e||e.removeEventListener(i.eventName,this.boundOnPopupShownHandler),null===(t=this._popupElement)||void 0===t||t.removeEventListener(p.eventName,this.boundOnPopupClosedHandler),this._popupElement=null,this.control.disposePopupElement()}}class _{}_.ClassName=b.Prefix+"-edit-dropdown",_.Header=_.ClassName+"-header",_.Body=b.Prefix+"-body",_.DropDownButton=b.Prefix+"-edit-btn-dropdown";class R extends d{constructor(e,t,o){super(e,t),this._focusTrapElement=null,this._parentStrategy=o,this._needRestoreInputFocus=!1}get parentStrategy(){return this._parentStrategy}get dropDownEditor(){return this.parentStrategy.dropDownEditor}getHeaderButtons(){return Array.from(this.targetElement.querySelectorAll(`.${_.Header} > .${v.Button}`))}addEventSubscriptions(){super.addEventSubscriptions(),this.boundOnDropDownEditorPointerDownHandler||(this.boundOnDropDownEditorPointerDownHandler=this.onDropDownEditorPointerDownHandler.bind(this),this.targetElement.addEventListener(H.eventName,this.boundOnDropDownEditorPointerDownHandler)),this.boundOnPopupClosingResultRequestedHandler||(this.boundOnPopupClosingResultRequestedHandler=this.onPopupClosingResultRequested.bind(this),this.targetElement.addEventListener(l.eventName,this.boundOnPopupClosingResultRequestedHandler))}onDispose(){this.boundOnDropDownEditorPointerDownHandler&&(this.targetElement.removeEventListener(H.eventName,this.boundOnDropDownEditorPointerDownHandler),this.boundOnDropDownEditorPointerDownHandler=void 0),this.boundOnPopupClosingResultRequestedHandler&&(this.targetElement.removeEventListener(l.eventName,this.boundOnPopupClosingResultRequestedHandler),this.boundOnPopupClosingResultRequestedHandler=void 0)}handleKeyDown(e){const t=D.KeyUtils.getEventKeyCode(e);return D.KeyUtils.getEventKeyCode(e)!==D.KeyCode.Tab&&(t===D.KeyCode.Esc||(e.altKey||e.metaKey)&&t===D.KeyCode.Up?(this._needRestoreInputFocus=!0,this.closeDropDown(),!0):super.handleKeyDown(e))}onDropDownEditorPointerDownHandler(){this.dropDownEditor.focused||this.parentStrategy.closeDropDown()}onPopupClosingResultRequested(){this.targetElement.contains(document.activeElement)?this.dropDownEditor.focusInternal():this.dropDownEditor.raiseFocusOutInternal(),this._needRestoreInputFocus=!1}closeDropDown(){this.parentStrategy.closeDropDown()}focusElementInRootPath(){}handlePopupShown(){this._needRestoreInputFocus=!1;const e=this.getNestedContentElement();this._focusTrapElement=e||this.targetElement,y.activate(this._focusTrapElement,!1,!0),super.handlePopupShown(),P(this.dropDownEditor)&&g(this.targetElement),this.dropDownEditor.classList.add(b.Focused)}onPopupClosed(){this.dropDownEditor.classList.remove(b.Focused),y.deactivate(this._focusTrapElement,!1),this._focusTrapElement=null,this._needRestoreInputFocus&&this.dropDownEditor.focusInternal(),this.handlePopupClosed()}}class B extends a{constructor(e,t,o){super(e,t),this._parentStrategy=o}get parentStrategy(){return this._parentStrategy}handlePopupShown(){super.handlePopupShown(),P(this.parentStrategy.dropDownEditor)&&g(this.targetElement)}}class I extends w{constructor(e){super(e)}get dropDownEditor(){return this._editor}handleKeyDown(e){const t=D.KeyUtils.getEventKeyCode(e);return(e.altKey||e.metaKey)&&t===D.KeyCode.Down?(this.openDropDown(),!0):(e.altKey||e.metaKey)&&t===D.KeyCode.Up?(this.closeDropDown(),!0):super.handleKeyDown(e)}closeDropDown(){this.dropDownEditor.closeDropDown()}openDropDown(){this.dropDownEditor.openDropDown()}closeDropDownAndApplyValue(e){this.performShortcutEvent(e)}}class N extends I{constructor(e){super(e)}initialize(){super.initialize(),this.subscribeToEvents()}subscribeToEvents(){this.boundOnPopupKeyboardStrategyCreating||(this.boundOnPopupKeyboardStrategyCreating=this.onPopupKeyboardStrategyCreating.bind(this),this.targetElement.addEventListener(u.eventName,this.boundOnPopupKeyboardStrategyCreating))}onPopupKeyboardStrategyCreating(e){e.detail.factory={createPopup:(e,t)=>this.createPopupStrategy(e,t),createModal:(e,t)=>this.createModalStrategy(e,t)}}onDispose(){this.boundOnPopupKeyboardStrategyCreating&&(this.targetElement.removeEventListener(u.eventName,this.boundOnPopupKeyboardStrategyCreating),this.boundOnPopupKeyboardStrategyCreating=void 0),super.onDispose()}createPopupStrategy(e,t){return new R(e,t,this)}createModalStrategy(e,t){return new B(e,t,this)}}var x;!function(e){e.ContentOrEditorWidth="ContentOrEditorWidth",e.ContentWidth="ContentWidth",e.EditorWidth="EditorWidth"}(x||(x={}));class F extends E{constructor(){super(),this.isDropDownOpen=!1,this.dropDownButtonElement=null,this.popupHelper=new K(this),this.dropDownWidthMode=x.ContentWidth,this._componentResizeObserver=new ResizeObserver(this.onSizeChanged.bind(this))}get useMobileFocusBehaviour(){return this.popupHelper.useMobileFocusBehaviour}get popupElement(){return this.popupHelper.popupElement}get dropDownElement(){return this.popupElement}get shouldProcessFocusOut(){if(!this.enabled||this.isReadOnly)return!1;return!(this.editBoxTemplateElement&&this.inputElement&&!C.DomUtils.isItParent(this.editBoxTemplateElement,this.inputElement))}connectedCallback(){super.connectedCallback(),this.popupHelper.onConnectedCallback(),this._componentResizeObserver.observe(this)}disconnectedCallback(){this.popupHelper.onDisconnectedCallback(),super.disconnectedCallback(),this._componentResizeObserver.disconnect()}contentChanged(){super.contentChanged(),this.popupHelper.onSlotChanged(),this.dropDownButtonElement=this.querySelector(`.${_.DropDownButton}`),c(this.editBoxElement)&&this.addLogicalChild(this.editBoxElement)}focusInternal(){var e;this.shouldApplySelectionOnFocus=!1,null===(e=this.editBoxElement)||void 0===e||e.focus(),this.shouldApplySelectionOnFocus=!0}processFocusOut(e){var t,n,s;const r=o.getEventSource(e);if(null===(t=this.popupElement)||void 0===t?void 0:t.contains(r))return;const i=null!==(n=e.relatedTarget)&&void 0!==n?n:document.activeElement;this.contains(i)&&!this.isFocusableElementInMainElementTemplate(i)||(null===(s=this.popupElement)||void 0===s?void 0:s.contains(i))||this.raiseFocusOutInternal()}raiseFocusOutInternal(){this.raiseFocusOut(this.fieldElement?this.fieldElementValue:this.fieldText)}processFocusIn(){this.focused&&super.processFocusIn()}processPointerDown(e){return o.containsInComposedPath(e,this.isDropDownButtonElement.bind(this))&&(this.toggleDropDownVisibility(),this.focused||(this.focusInternal(),this.dispatchDropDownEditorPointerDownEvent()),o.markHandled(e)),g(this),super.processPointerDown(e)}canHandlePointerDown(e){return t.containsInComposedPath(e,this.dropDownButtonElement)||t.containsInComposedPath(e,this.inputElement)}processKeyDownServerCommand(e){return!1}shouldProcessKeyDown(e){return!e.altKey&&super.shouldProcessKeyDown(e)}shouldProcessKeyUp(e){return!e.altKey&&super.shouldProcessKeyUp(e)}ensurePopupElement(){}disposePopupElement(){}openDropDown(){this.dispatchEvent(new O)}closeDropDown(){this.dispatchEvent(new S)}async processCapturedPointerDownAsync(e,t){return this.canHandlePointerDown(e)?(t.handled=!0,Promise.resolve()):super.processCapturedPointerDownAsync(e,t)}createKeyboardStrategy(){return new I(this)}updated(e){super.updated(e),e.has("dropDownWidthMode")&&this.reconnectComponentResizeObserver()}toggleDropDownVisibility(){this.isDropDownOpen?this.closeDropDown():this.enabled&&!this.isReadOnly&&this.openDropDown()}tryOpenDropDown(){this.enabled&&!this.isReadOnly&&this.openDropDown()}tryCloseDropDown(){this.isDropDownOpen&&this.closeDropDown()}onSizeChanged(e,t){if(!this.dropDownElement)return;const o=`${e[0].target.getBoundingClientRect().width}px`;this.dropDownElement.desiredWidth=this.dropDownWidthMode===x.EditorWidth?o:null,this.dropDownElement.minDesiredWidth=this.dropDownWidthMode===x.ContentOrEditorWidth?o:null}dispatchDropDownEditorPointerDownEvent(){document.dispatchEvent(new H)}isDropDownButtonElement(e){var t;return!!e&&(null===(t=e.classList)||void 0===t?void 0:t.contains(_.DropDownButton))}isEditBoxElement(e){return e===this.fieldElement||e===this.editBoxTemplateElement}isFieldElement(e){return e===this.fieldElement}isEditBoxTemplateElement(e){return e===this.editBoxTemplateElement}reconnectComponentResizeObserver(){this.isDOMAttached&&(this._componentResizeObserver.disconnect(),this.dropDownElement&&(this.dropDownElement.desiredWidth=null,this.dropDownElement.minDesiredWidth=null),this._componentResizeObserver.observe(this))}}e([f({type:Boolean,attribute:"is-dropdown-open"})],F.prototype,"isDropDownOpen",void 0),e([f({type:x,attribute:"dropdown-width-mode"})],F.prototype,"dropDownWidthMode",void 0);export{F as D,R as E,N as a,x as b,_ as c};
